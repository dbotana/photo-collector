<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S3 Upload Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .pass { color: green; font-weight: bold; }
        .fail { color: red; font-weight: bold; }
        .info { color: blue; }
        .warning { color: orange; }
        input, textarea { width: 100%; padding: 8px; margin: 5px 0; box-sizing: border-box; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .config-form { background: #f5f5f5; padding: 15px; border-radius: 8px; }
        .test-result { padding: 10px; margin: 5px 0; border-radius: 4px; }
        .test-result.pass { background: #e8f5e8; }
        .test-result.fail { background: #ffe8e8; }
        .test-result.info { background: #e8f0ff; }
    </style>
</head>
<body>
    <h1>S3 Upload Functionality Tests</h1>

    <div class="test-section">
        <h3>S3 Configuration Test</h3>
        <div class="config-form">
            <label>S3 Bucket Name:</label>
            <input type="text" id="testBucket" placeholder="your-test-bucket">

            <label>AWS Region:</label>
            <input type="text" id="testRegion" placeholder="us-east-1">

            <label>Access Key ID:</label>
            <input type="text" id="testAccessKey" placeholder="AKIAIOSFODNN7EXAMPLE">

            <label>Secret Access Key:</label>
            <input type="password" id="testSecretKey" placeholder="wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY">

            <button onclick="testS3Config()">Test S3 Configuration</button>
        </div>
        <div id="s3ConfigResults"></div>
    </div>

    <div class="test-section">
        <h3>File Validation Tests</h3>
        <input type="file" id="testFileInput" accept="image/*" multiple>
        <button onclick="testFileValidation()">Test Selected Files</button>
        <div id="fileValidationResults"></div>
    </div>

    <div class="test-section">
        <h3>Error Handling Tests</h3>
        <button onclick="testErrorHandling()">Test Error Scenarios</button>
        <div id="errorTestResults"></div>
    </div>

    <div class="test-section">
        <h3>Mock Upload Test</h3>
        <button onclick="testMockUpload()">Test Mock S3 Upload</button>
        <div id="mockUploadResults"></div>
    </div>

    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1563.0.min.js"></script>
    <script>
        function logResult(message, type = 'info', containerId) {
            const result = document.createElement('div');
            result.className = `test-result ${type}`;
            result.innerHTML = `<span class="${type}">● ${message}</span>`;
            document.getElementById(containerId).appendChild(result);
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        // Test S3 configuration validation
        function testS3Config() {
            clearResults('s3ConfigResults');

            const bucket = document.getElementById('testBucket').value.trim();
            const region = document.getElementById('testRegion').value.trim();
            const accessKey = document.getElementById('testAccessKey').value.trim();
            const secretKey = document.getElementById('testSecretKey').value.trim();

            // Test empty values
            if (!bucket) {
                logResult('Bucket name is required', 'fail', 's3ConfigResults');
            } else if (!/^[a-z0-9][a-z0-9.-]{1,61}[a-z0-9]$/.test(bucket)) {
                logResult('Invalid bucket name format', 'fail', 's3ConfigResults');
            } else {
                logResult('Bucket name format is valid', 'pass', 's3ConfigResults');
            }

            if (!region) {
                logResult('Region is required', 'fail', 's3ConfigResults');
            } else if (!/^[a-z0-9-]+$/.test(region)) {
                logResult('Invalid region format', 'fail', 's3ConfigResults');
            } else {
                logResult('Region format is valid', 'pass', 's3ConfigResults');
            }

            if (!accessKey) {
                logResult('Access Key ID is required', 'fail', 's3ConfigResults');
            } else if (!/^[A-Z0-9]{20}$/.test(accessKey)) {
                logResult('Invalid Access Key ID format (should be 20 uppercase alphanumeric characters)', 'fail', 's3ConfigResults');
            } else {
                logResult('Access Key ID format is valid', 'pass', 's3ConfigResults');
            }

            if (!secretKey) {
                logResult('Secret Access Key is required', 'fail', 's3ConfigResults');
            } else if (secretKey.length !== 40) {
                logResult('Invalid Secret Access Key length (should be 40 characters)', 'fail', 's3ConfigResults');
            } else {
                logResult('Secret Access Key length is valid', 'pass', 's3ConfigResults');
            }

            // Test AWS SDK initialization
            if (bucket && region && accessKey && secretKey) {
                try {
                    AWS.config.update({
                        accessKeyId: accessKey,
                        secretAccessKey: secretKey,
                        region: region
                    });

                    const s3 = new AWS.S3({
                        apiVersion: '2006-03-01',
                        params: { Bucket: bucket }
                    });

                    logResult('AWS SDK initialized successfully', 'pass', 's3ConfigResults');

                    // Test bucket access (this will likely fail with test credentials)
                    s3.headBucket({ Bucket: bucket }).promise()
                        .then(() => {
                            logResult('✅ Bucket access successful!', 'pass', 's3ConfigResults');
                        })
                        .catch((error) => {
                            logResult(`⚠️ Bucket access failed: ${error.code || error.message}`, 'warning', 's3ConfigResults');
                        });

                } catch (error) {
                    logResult(`AWS SDK initialization failed: ${error.message}`, 'fail', 's3ConfigResults');
                }
            }
        }

        // Test file validation
        function testFileValidation() {
            clearResults('fileValidationResults');

            const files = document.getElementById('testFileInput').files;
            const maxSize = 10 * 1024 * 1024; // 10MB
            const supportedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];

            if (files.length === 0) {
                logResult('No files selected', 'info', 'fileValidationResults');
                return;
            }

            Array.from(files).forEach((file, index) => {
                logResult(`Testing file ${index + 1}: ${file.name}`, 'info', 'fileValidationResults');

                // Test file type
                if (supportedTypes.includes(file.type)) {
                    logResult(`✅ File type supported: ${file.type}`, 'pass', 'fileValidationResults');
                } else {
                    logResult(`❌ Unsupported file type: ${file.type}`, 'fail', 'fileValidationResults');
                }

                // Test file size
                if (file.size <= maxSize) {
                    logResult(`✅ File size OK: ${Math.round(file.size / 1024 / 1024 * 100) / 100}MB`, 'pass', 'fileValidationResults');
                } else {
                    logResult(`❌ File too large: ${Math.round(file.size / 1024 / 1024 * 100) / 100}MB (max 10MB)`, 'fail', 'fileValidationResults');
                }

                // Test file integrity
                if (file.size === 0) {
                    logResult('❌ File appears to be empty or corrupted', 'fail', 'fileValidationResults');
                } else {
                    logResult('✅ File has content', 'pass', 'fileValidationResults');
                }

                // Test if file can be read as image
                if (file.type.startsWith('image/')) {
                    const img = new Image();
                    const url = URL.createObjectURL(file);

                    img.onload = () => {
                        logResult(`✅ Image loaded successfully: ${img.width}x${img.height}px`, 'pass', 'fileValidationResults');
                        URL.revokeObjectURL(url);
                    };

                    img.onerror = () => {
                        logResult('❌ Failed to load image - file may be corrupted', 'fail', 'fileValidationResults');
                        URL.revokeObjectURL(url);
                    };

                    img.src = url;
                }
            });
        }

        // Test error handling scenarios
        function testErrorHandling() {
            clearResults('errorTestResults');

            const errorScenarios = [
                {
                    name: 'Network offline',
                    test: () => !navigator.onLine,
                    message: 'Network is offline'
                },
                {
                    name: 'AWS SDK availability',
                    test: () => typeof AWS === 'undefined',
                    message: 'AWS SDK not loaded'
                },
                {
                    name: 'Local storage availability',
                    test: () => !window.localStorage,
                    message: 'Local storage not available'
                },
                {
                    name: 'File API support',
                    test: () => !window.File || !window.FileReader,
                    message: 'File API not supported'
                },
                {
                    name: 'Canvas API support',
                    test: () => {
                        try {
                            const canvas = document.createElement('canvas');
                            return !canvas.getContext('2d');
                        } catch (e) {
                            return true;
                        }
                    },
                    message: 'Canvas API not supported'
                }
            ];

            errorScenarios.forEach(scenario => {
                if (scenario.test()) {
                    logResult(`❌ ${scenario.name}: ${scenario.message}`, 'fail', 'errorTestResults');
                } else {
                    logResult(`✅ ${scenario.name}: Available`, 'pass', 'errorTestResults');
                }
            });

            // Test mock error handling
            try {
                throw new Error('Test error');
            } catch (error) {
                logResult(`✅ Error handling works: Caught "${error.message}"`, 'pass', 'errorTestResults');
            }
        }

        // Test mock upload functionality
        function testMockUpload() {
            clearResults('mockUploadResults');

            logResult('🔄 Starting mock upload test...', 'info', 'mockUploadResults');

            // Simulate upload progress
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 20;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    logResult('✅ Mock upload completed successfully!', 'pass', 'mockUploadResults');
                }
                logResult(`📊 Upload progress: ${Math.round(progress)}%`, 'info', 'mockUploadResults');
            }, 200);

            // Test metadata creation
            const mockMetadata = {
                description: 'Test description',
                'upload-timestamp': new Date().toISOString(),
                'original-filename': 'test-image.jpg',
                'file-size': '123456',
                'app-version': '1.0.0'
            };

            logResult(`📝 Mock metadata created: ${Object.keys(mockMetadata).length} properties`, 'pass', 'mockUploadResults');
        }
    </script>
</body>
</html>