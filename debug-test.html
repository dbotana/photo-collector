<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .log { margin: 5px 0; padding: 10px; border-radius: 4px; }
        .error { background: #ffe6e6; border: 1px solid red; }
        .success { background: #e6ffe6; border: 1px solid green; }
        .info { background: #e6f3ff; border: 1px solid blue; }
    </style>
</head>
<body>
    <h1>Photo Collector Debug Test</h1>
    <div id="logs"></div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            document.getElementById('logs').appendChild(logDiv);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // Test 1: Basic JavaScript
        log('JavaScript is working', 'success');

        // Test 2: DOM Ready
        document.addEventListener('DOMContentLoaded', () => {
            log('DOM Content Loaded', 'success');
        });

        // Test 3: AWS SDK Loading
        const awsScript = document.createElement('script');
        awsScript.src = 'https://sdk.amazonaws.com/js/aws-sdk-2.1563.0.min.js';
        awsScript.onload = () => {
            log('AWS SDK loaded successfully', 'success');
            if (typeof AWS !== 'undefined') {
                log(`AWS SDK version: ${AWS.VERSION}`, 'info');
            }
        };
        awsScript.onerror = () => {
            log('AWS SDK failed to load', 'error');
        };
        document.head.appendChild(awsScript);

        // Test 4: Main app script loading
        const appScript = document.createElement('script');
        appScript.src = 'script.js';
        appScript.onload = () => {
            log('Main script loaded successfully', 'success');

            // Test 5: Class availability
            setTimeout(() => {
                try {
                    // Test if we can access the class
                    if (typeof PhotoCollector !== 'undefined') {
                        log('PhotoCollector class is available', 'success');
                    } else {
                        log('PhotoCollector class not found', 'error');
                    }

                    // Test DOM elements
                    const testElements = [
                        'cameraBtn', 'uploadBtn', 'fileInput', 'cameraContainer',
                        'cameraVideo', 'previewImage', 'description', 'uploadToS3Btn',
                        's3Bucket', 's3Region', 's3AccessKey', 's3SecretKey'
                    ];

                    let missingElements = [];
                    testElements.forEach(id => {
                        if (!document.getElementById(id)) {
                            missingElements.push(id);
                        }
                    });

                    if (missingElements.length === 0) {
                        log('All required DOM elements found', 'success');
                    } else {
                        log(`Missing DOM elements: ${missingElements.join(', ')}`, 'error');
                    }

                } catch (error) {
                    log(`Error testing PhotoCollector: ${error.message}`, 'error');
                }
            }, 100);
        };
        appScript.onerror = () => {
            log('Main script failed to load', 'error');
        };

        // Test if we can access the main page
        fetch('index.html')
            .then(response => {
                if (response.ok) {
                    log('index.html accessible', 'success');
                    return response.text();
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            })
            .then(html => {
                log(`index.html loaded (${html.length} characters)`, 'info');

                // Create a temporary div to test the HTML
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;
                document.body.appendChild(tempDiv);

                // Load the app script after HTML is inserted
                document.head.appendChild(appScript);
            })
            .catch(error => {
                log(`Error loading index.html: ${error.message}`, 'error');
            });

        // Test browser capabilities
        log(`User Agent: ${navigator.userAgent}`, 'info');
        log(`Camera API: ${navigator.mediaDevices ? 'Available' : 'Not available'}`, navigator.mediaDevices ? 'success' : 'error');
        log(`File API: ${window.File ? 'Available' : 'Not available'}`, window.File ? 'success' : 'error');
        log(`LocalStorage: ${window.localStorage ? 'Available' : 'Not available'}`, window.localStorage ? 'success' : 'error');
    </script>
</body>
</html>