<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Collector Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        .pass { color: green; }
        .fail { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Photo Collector - Test Results</h1>

    <div class="test-section">
        <h3>Browser Compatibility Tests</h3>
        <div id="compatibility-results"></div>
    </div>

    <div class="test-section">
        <h3>DOM Elements Test</h3>
        <div id="dom-results"></div>
    </div>

    <div class="test-section">
        <h3>Feature Support Tests</h3>
        <div id="feature-results"></div>
    </div>

    <div class="test-section">
        <h3>Load Main App</h3>
        <a href="index.html" target="_blank">Open Photo Collector App</a>
    </div>

    <script>
        function log(message, type = 'info') {
            return `<div class="${type}">✓ ${message}</div>`;
        }

        function logError(message) {
            return `<div class="fail">✗ ${message}</div>`;
        }

        // Test browser compatibility
        function testCompatibility() {
            let results = '';

            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                results += log('Camera API supported');
            } else {
                results += logError('Camera API not supported');
            }

            if (window.File && window.FileReader && window.FileList && window.Blob) {
                results += log('File API supported');
            } else {
                results += logError('File API not supported');
            }

            if (window.localStorage) {
                results += log('Local Storage supported');
            } else {
                results += logError('Local Storage not supported');
            }

            if ('serviceWorker' in navigator) {
                results += log('Service Worker supported');
            } else {
                results += logError('Service Worker not supported');
            }

            return results;
        }

        // Test DOM elements
        function testDOM() {
            const requiredElements = [
                'cameraBtn', 'uploadBtn', 'fileInput', 'cameraContainer', 'cameraVideo',
                'captureBtn', 'closeCameraBtn', 'previewSection', 'previewImage',
                'removeImageBtn', 'description', 'uploadToS3Btn', 'progressContainer',
                'progressFill', 'progressText', 'messageContainer', 's3Bucket',
                's3Region', 's3AccessKey', 's3SecretKey'
            ];

            let results = '';
            let missingElements = [];

            // Load the main page content for testing
            fetch('index.html')
                .then(response => response.text())
                .then(html => {
                    requiredElements.forEach(id => {
                        if (html.includes(`id="${id}"`)) {
                            results += log(`Element #${id} found`);
                        } else {
                            results += logError(`Element #${id} missing`);
                            missingElements.push(id);
                        }
                    });

                    if (missingElements.length === 0) {
                        results += log('All required DOM elements present', 'pass');
                    } else {
                        results += logError(`Missing ${missingElements.length} required elements`);
                    }

                    document.getElementById('dom-results').innerHTML = results;
                })
                .catch(error => {
                    document.getElementById('dom-results').innerHTML = logError('Failed to load index.html for testing');
                });
        }

        // Test feature support
        function testFeatures() {
            let results = '';

            // Test Canvas support
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                if (ctx) {
                    results += log('Canvas API supported');
                } else {
                    results += logError('Canvas API not supported');
                }
            } catch (e) {
                results += logError('Canvas API error: ' + e.message);
            }

            // Test Blob URL support
            if (window.URL && window.URL.createObjectURL) {
                results += log('Blob URL API supported');
            } else {
                results += logError('Blob URL API not supported');
            }

            // Test network status
            if (navigator.onLine) {
                results += log('Network connection available');
            } else {
                results += logError('No network connection');
            }

            // Test HTTPS (required for camera in production)
            if (location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
                results += log('Secure context (HTTPS/localhost) - Camera will work');
            } else {
                results += logError('Insecure context - Camera may not work in production');
            }

            return results;
        }

        // Run tests
        document.getElementById('compatibility-results').innerHTML = testCompatibility();
        document.getElementById('feature-results').innerHTML = testFeatures();
        testDOM();

        // Test AWS SDK loading
        const awsScript = document.createElement('script');
        awsScript.src = 'https://sdk.amazonaws.com/js/aws-sdk-2.1563.0.min.js';
        awsScript.onload = () => {
            document.getElementById('feature-results').innerHTML += log('AWS SDK loaded successfully', 'pass');
        };
        awsScript.onerror = () => {
            document.getElementById('feature-results').innerHTML += logError('AWS SDK failed to load');
        };
        document.head.appendChild(awsScript);
    </script>
</body>
</html>